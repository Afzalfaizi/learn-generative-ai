# FastAPI App with Neon Serverless Postgres

https://neon.tech/blog/deploy-a-serverless-fastapi-app-with-neon-postgres-and-aws-app-runner-at-any-scale

Code:

https://github.com/neondatabase/fastapi-apprunner-neon

Note: We can use it as a template also

Create Project:

    poetry new fastapi-helloworld

Change directory to project:

    cd fastapi-helloworld 

Add dependecies:

    poetry install

Add poetry virtualenv interpreter in VSCode

Write main.py

Create a Neon Database Project and copy the connection string and paste it to .env file (check .env_back sample):

https://neon.tech/docs/guides/python#create-a-neon-project

Create a Neon Database Project Test Branch and copy the connection string and paste it to .env file (check .env_back sample):

https://neon.tech/docs/manage/branches#create-a-branch

Run test:

    poetry run pytest

Run project in Poetry Envirnoment:

    poetry run uvicorn fastapi_neon.main:app --host 0.0.0.0 --port 8000

Open in Browser:

    http://0.0.0.0:8000/

    http://0.0.0.0:8000/docs

    http://0.0.0.0:8000/openapi.json

## Publish on the Web while running locally

Install Ngrok:

https://ngrok.com/docs/getting-started/

Run the following command to add your authtoken to the default ngrok.yml:

    ngrok config add-authtoken 2bZGNZ3Mj3HdRxPt19defOl_7oFHsvr5AmM9A9UZUyhFn

Deploy with your static domain:

    ngrok http --domain=my-static-domain.ngrok-free.app 8000

Open in Browser:

    https://my-static-domain.ngrok-free.app/

Open in Browser:

    https://my-static-domain.ngrok-free.app/

Open Docs in Browser:

    https://my-static-domain.ngrok-free.app/docs

Open OpenAPI specs in Browser:

    https://my-static-domain.ngrok-free.app/openapi.json

Now we will use this json to create GPT Action.

Now create a Custom GPT here:

    https://chat.openai.com/gpts

Add the following server url in the openapi.json file generated by FastAPI and paste it into action schema:

    "servers": [
        {
        "url": "https://my-static-domain.ngrok-free.app/"
        }
    ],

## Features

- **FastAPI**: A modern, fast (high-performance) web framework for building APIs with Python 3.11, featuring automatic Swagger UI generation, type checking, and asynchronous request handling.
- **Neon Serverless Postgres**: A scalable, fully managed serverless Postgres database, minimizing operational overhead.
- **AWS App Runner**: An AWS service that provides a simple, fully managed environment for deploying containerized-type applications, eliminating the need for infrastructure configuration and management.

## Prerequisites

- Python 3.11
- AWS Account
- A [Neon account for Serverless Postgres](https://neon.tech/)
- Git
- [Poetry](https://python-poetry.org/) for Python dependency management

## Getting Started

### 1. Clone the Repository

Clone the repository to your local machine and navigate into the project directory:

```bash
git clone https://github.com/neondatabase/fastapi-apprunner-neon
cd fastapi-apprunner-neon
```

### 2. Setup Your Python Environment with Poetry

Initialize a new environment using Poetry and install the project dependencies:

```sh
poetry install
```

### 3. Neon Serverless Postgres

- Sign up or log in to your Neon account
- You'll need this the database connection string for configuration.

### 4. Deploy to AWS App Runner

Follow along in the blog post to configure AWS SSM Parameter Store and deploy the FastAPI to AWS App Runner.
